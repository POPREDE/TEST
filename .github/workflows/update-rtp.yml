name: Update RTP JSON

on:
  schedule:
    - cron: "*/5 * * * *"   # setiap 5 menit
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Generate RTP JSON
        run: |
          node << 'EOF'
          const fs = require("fs");

          function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
          }

          function generateRTP(count) {
            const arr = [];
            const top = Math.floor(Math.random() * 2) + 3; // 3-4 game 98%
            for (let i = 0; i < top; i++) arr.push(98);

            for (let i = 0; i < 10; i++) arr.push(Math.floor(Math.random()*8)+90);

            while (arr.length < count) arr.push(Math.floor(Math.random()*40)+50);

            return shuffle(arr);
          }

          const total_pg = 200;         // kamu bisa sesuaikan
          const total_prag = 200;

          const newData = {
            generated_at: new Date().toISOString(),
            provider: {
              PG: generateRTP(total_pg),
              PRAGMATIC: generateRTP(total_prag)
            }
          };

          fs.writeFileSync("rtp.json", JSON.stringify(newData, null, 2));
          EOF

      - name: Commit file
        run: |
          git config --global user.name  "github-actions"
          git config --global user.email "actions@github.com"
          git add rtp.json
          git commit -m "Auto update RTP" || echo "No changes"
          git push
